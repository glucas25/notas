<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Boletas - U.E.F. Juan Le√≥n Mera</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-stats.css">
    <script src="theme.js"></script>
</head>
<body>
    <!-- Bot√≥n de acceso de administrador -->
    <button class="admin-access" onclick="openAdminModal()" title="Acceso Administrador">
        ‚öôÔ∏è
    </button>

    <!-- Bot√≥n de modo oscuro/claro -->
    <button class="theme-toggle" id="themeToggle" title="Cambiar modo claro/oscuro">üåô</button>

    <!-- Modal de login administrativo -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîê Acceso Administrativo</h3>
                <p>Ingrese sus credenciales de administrador</p>
            </div>
            <form onsubmit="loginAdmin(event)">
                <div class="form-group">
                    <label for="adminUser">Usuario:</label>
                    <input type="text" id="adminUser" required>
                </div>
                <div class="form-group">
                    <label for="adminPass">Contrase√±a:</label>
                    <input type="password" id="adminPass" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-modal btn-secondary" onclick="closeAdminModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-modal btn-primary">
                        Iniciar Sesi√≥n
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <!-- Logo eliminado -->
            <div class="institution-name">Unidad Educativa Fiscal "Juan Le√≥n Mera"</div>
            <h1>üìö Consulta de Notas de Estudiantes</h1>
            <p>Primer Trimestre 2025</p>
        </div>

        <!-- Panel de administrador (oculto por defecto) -->
        <div class="admin-panel" id="adminPanel">
            <h3>
                üìä Panel Administrativo
                <button class="admin-logout" onclick="logoutAdmin()">Cerrar Sesi√≥n</button>
                <button class="btn-refresh" onclick="loadData()" id="refreshBtn">
                    üîÑ Actualizar Datos
                </button>
            </h3>
            
            <div class="data-stats" id="dataStats">
                <strong>Estad√≠sticas Generales del Sistema:</strong>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalRecords">0</div>
                        <div class="stat-label">Total Registros</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="uniqueStudents">0</div>
                        <div class="stat-label">Estudiantes √∫nicos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalSubjects">0</div>
                        <div class="stat-label">Asignaturas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="lastUpdate">-</div>
                        <div class="stat-label">√öltima actualizaci√≥n</div>
                    </div>
                </div>
            </div>
            
            <!-- Nueva secci√≥n de estad√≠sticas detalladas -->
            <div class="detailed-stats" id="detailedStats">
                <!-- Las estad√≠sticas detalladas se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>

        <div class="search-section" id="searchSection">
            <div class="search-container">
                <div class="input-group">
                    <label for="cedulaInput">N√∫mero de C√©dula:</label>
                    <div class="input-with-button">
                        <input type="text" id="cedulaInput" placeholder="Ingrese el n√∫mero de c√©dula del estudiante">
                        <button class="btn" onclick="buscarEstudiante()" id="searchBtn">
                            üîç Buscar Estudiante
                        </button>
                        <button class="btn btn-secondary" onclick="nuevaBusqueda()" id="newSearchBtn" style="display: none;">
                            ‚Ü©Ô∏è Nueva B√∫squeda
                        </button>
                    </div>
                </div>
            
                </button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Cargando datos desde Google Sheets...</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <div class="results-section" id="resultsSection">
            <div class="student-info" id="studentInfo">
                <h2>üìã Informaci√≥n del Estudiante</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Nombre Completo</div>
                        <div class="info-value" id="studentName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">C√©dula</div>
                        <div class="info-value" id="studentId">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Subnivel</div>
                        <div class="info-value" id="studentSubnivel">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Curso</div>
                        <div class="info-value" id="studentCurso">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Paralelo</div>
                        <div class="info-value" id="studentParalelo">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Per√≠odo Lectivo</div>
                        <div class="info-value" id="studentPeriodo">-</div>
                    </div>
                </div>
            </div>

            <div class="grades-section">
                <h3>üìä Calificaciones por Trimestre</h3>
                <div class="table-container">
                    <table class="grades-table">
                        <thead>
                            <tr>
                                <th>Asignatura</th>
                                <th>Trimestre 1</th>
                                <th>Trimestre 2</th>
                                <th>Trimestre 3</th>
                                <th>Promedio</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="gradesTableBody">
                            <!-- Los datos se cargar√°n aqu√≠ din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- PapaParse para procesar CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="script.js"></script>
</body>
</html>